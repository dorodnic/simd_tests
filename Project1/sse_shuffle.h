#pragma once

#include <tmmintrin.h>

#define SET_SCATTER_SHUFFLE(G, O, L, S, M) \
template<>\
struct scatter_shuffle<G, O, L>\
{\
    static constexpr unsigned int shuffle() { return S; }\
    static constexpr unsigned int mask() { return M; }\
}

#define SET_GATHER_SHUFFLE(G, O, L, S, M) \
template<>\
struct gather_shuffle<G, O, L>\
{\
    static constexpr unsigned int shuffle() { return S; }\
    static constexpr unsigned int mask() { return M; }\
}

namespace simd
{
    namespace sse
    {
        template<int GAP, int OFFSET, int LINE>
        struct scatter_shuffle {};
        template<int GAP, int OFFSET, int LINE>
        struct gather_shuffle {};

        SET_SCATTER_SHUFFLE(2, 0, 0, _MM_SHUFFLE(0, 1, 0, 0), 0x00FF00FF);
        SET_GATHER_SHUFFLE(2, 0, 0, _MM_SHUFFLE(0, 0, 2, 0), 0x00FEFF01);
        SET_SCATTER_SHUFFLE(2, 0, 1, _MM_SHUFFLE(0, 3, 0, 2), 0x00FF00FF);
        SET_GATHER_SHUFFLE(2, 0, 1, _MM_SHUFFLE(2, 0, 0, 0), 0xFF010000);
        SET_SCATTER_SHUFFLE(2, 1, 0, _MM_SHUFFLE(1, 0, 0, 0), 0xFF00FF00);
        SET_GATHER_SHUFFLE(2, 1, 0, _MM_SHUFFLE(0, 0, 3, 1), 0x00FEFF01);
        SET_SCATTER_SHUFFLE(2, 1, 1, _MM_SHUFFLE(3, 0, 2, 0), 0xFF00FF00);
        SET_GATHER_SHUFFLE(2, 1, 1, _MM_SHUFFLE(3, 1, 0, 0), 0xFF010000);
        SET_SCATTER_SHUFFLE(3, 0, 0, _MM_SHUFFLE(1, 0, 0, 0), 0xFF0000FF);
        SET_GATHER_SHUFFLE(3, 0, 0, _MM_SHUFFLE(0, 0, 3, 0), 0x00FEFF01);
        SET_SCATTER_SHUFFLE(3, 0, 1, _MM_SHUFFLE(0, 2, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(3, 0, 1, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 0, 2, _MM_SHUFFLE(0, 0, 3, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(3, 0, 2, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 1, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(3, 1, 0, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 1, 1, _MM_SHUFFLE(2, 0, 0, 1), 0xFF0000FF);
        SET_GATHER_SHUFFLE(3, 1, 1, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 1, 2, _MM_SHUFFLE(0, 3, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(3, 1, 2, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 2, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(3, 2, 0, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 2, 1, _MM_SHUFFLE(0, 0, 1, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(3, 2, 1, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(3, 2, 2, _MM_SHUFFLE(3, 0, 0, 2), 0xFF0000FF);
        SET_GATHER_SHUFFLE(3, 2, 2, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(4, 0, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x000000FF);
        SET_GATHER_SHUFFLE(4, 0, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FE01);
        SET_SCATTER_SHUFFLE(4, 0, 1, _MM_SHUFFLE(0, 0, 0, 1), 0x000000FF);
        SET_GATHER_SHUFFLE(4, 0, 1, _MM_SHUFFLE(0, 0, 0, 0), 0x00FE0100);
        SET_SCATTER_SHUFFLE(4, 0, 2, _MM_SHUFFLE(0, 0, 0, 2), 0x000000FF);
        SET_GATHER_SHUFFLE(4, 0, 2, _MM_SHUFFLE(0, 0, 0, 0), 0xFE010000);
        SET_SCATTER_SHUFFLE(4, 0, 3, _MM_SHUFFLE(0, 0, 0, 3), 0x000000FF);
        SET_GATHER_SHUFFLE(4, 0, 3, _MM_SHUFFLE(0, 0, 0, 0), 0x01000000);
        SET_SCATTER_SHUFFLE(4, 1, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(4, 1, 0, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(4, 1, 1, _MM_SHUFFLE(0, 0, 1, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(4, 1, 1, _MM_SHUFFLE(0, 0, 1, 0), 0x00FE0100);
        SET_SCATTER_SHUFFLE(4, 1, 2, _MM_SHUFFLE(0, 0, 2, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(4, 1, 2, _MM_SHUFFLE(0, 1, 0, 0), 0xFE010000);
        SET_SCATTER_SHUFFLE(4, 1, 3, _MM_SHUFFLE(0, 0, 3, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(4, 1, 3, _MM_SHUFFLE(1, 0, 0, 0), 0x01000000);
        SET_SCATTER_SHUFFLE(4, 2, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(4, 2, 0, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(4, 2, 1, _MM_SHUFFLE(0, 1, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(4, 2, 1, _MM_SHUFFLE(0, 0, 2, 0), 0x00FE0100);
        SET_SCATTER_SHUFFLE(4, 2, 2, _MM_SHUFFLE(0, 2, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(4, 2, 2, _MM_SHUFFLE(0, 2, 0, 0), 0xFE010000);
        SET_SCATTER_SHUFFLE(4, 2, 3, _MM_SHUFFLE(0, 3, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(4, 2, 3, _MM_SHUFFLE(2, 0, 0, 0), 0x01000000);
        SET_SCATTER_SHUFFLE(4, 3, 0, _MM_SHUFFLE(0, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(4, 3, 0, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(4, 3, 1, _MM_SHUFFLE(1, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(4, 3, 1, _MM_SHUFFLE(0, 0, 3, 0), 0x00FE0100);
        SET_SCATTER_SHUFFLE(4, 3, 2, _MM_SHUFFLE(2, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(4, 3, 2, _MM_SHUFFLE(0, 3, 0, 0), 0xFE010000);
        SET_SCATTER_SHUFFLE(4, 3, 3, _MM_SHUFFLE(3, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(4, 3, 3, _MM_SHUFFLE(3, 0, 0, 0), 0x01000000);
        SET_SCATTER_SHUFFLE(5, 0, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x000000FF);
        SET_GATHER_SHUFFLE(5, 0, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 0, 1, _MM_SHUFFLE(0, 0, 1, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(5, 0, 1, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 0, 2, _MM_SHUFFLE(0, 2, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(5, 0, 2, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 0, 3, _MM_SHUFFLE(3, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(5, 0, 3, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 0, 4, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_GATHER_SHUFFLE(5, 0, 4, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 1, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(5, 1, 0, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 1, 1, _MM_SHUFFLE(0, 1, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(5, 1, 1, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 1, 2, _MM_SHUFFLE(2, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(5, 1, 2, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 1, 3, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_GATHER_SHUFFLE(5, 1, 3, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 1, 4, _MM_SHUFFLE(0, 0, 0, 3), 0x000000FF);
        SET_GATHER_SHUFFLE(5, 1, 4, _MM_SHUFFLE(0, 0, 0, 1), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 2, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(5, 2, 0, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 2, 1, _MM_SHUFFLE(1, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(5, 2, 1, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 2, 2, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_GATHER_SHUFFLE(5, 2, 2, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 2, 3, _MM_SHUFFLE(0, 0, 0, 2), 0x000000FF);
        SET_GATHER_SHUFFLE(5, 2, 3, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 2, 4, _MM_SHUFFLE(0, 0, 3, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(5, 2, 4, _MM_SHUFFLE(0, 0, 0, 2), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 3, 0, _MM_SHUFFLE(0, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(5, 3, 0, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 3, 1, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_GATHER_SHUFFLE(5, 3, 1, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 3, 2, _MM_SHUFFLE(0, 0, 0, 1), 0x000000FF);
        SET_GATHER_SHUFFLE(5, 3, 2, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 3, 3, _MM_SHUFFLE(0, 0, 2, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(5, 3, 3, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 3, 4, _MM_SHUFFLE(0, 3, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(5, 3, 4, _MM_SHUFFLE(0, 0, 0, 3), 0x0000FE01);
        SET_SCATTER_SHUFFLE(5, 4, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_GATHER_SHUFFLE(5, 4, 0, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_SCATTER_SHUFFLE(5, 4, 1, _MM_SHUFFLE(0, 0, 0, 0), 0x000000FF);
        SET_GATHER_SHUFFLE(5, 4, 1, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_SCATTER_SHUFFLE(5, 4, 2, _MM_SHUFFLE(0, 0, 1, 0), 0x0000FF00);
        SET_GATHER_SHUFFLE(5, 4, 2, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_SCATTER_SHUFFLE(5, 4, 3, _MM_SHUFFLE(0, 2, 0, 0), 0x00FF0000);
        SET_GATHER_SHUFFLE(5, 4, 3, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
        SET_SCATTER_SHUFFLE(5, 4, 4, _MM_SHUFFLE(3, 0, 0, 0), 0xFF000000);
        SET_GATHER_SHUFFLE(5, 4, 4, _MM_SHUFFLE(0, 0, 0, 0), 0x00000000);
    }
}

#undef SET_SCATTER_SHUFFLE